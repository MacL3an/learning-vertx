<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Service status</title>

    <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.3.3/underscore-min.js" type="text/javascript"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/backbone.js/0.9.2/backbone-min.js" type="text/javascript"></script>

</head>
<body>
<div class="serviceapp" role="main">
    <div class="page-header">
        <div class="row">
            <div class="col-md-12">
                <h1>Services</h1>
                <button class="pull-right btn btn-primary" data-action="add" data-toggle="modal"
                        data-target="#newService">
                    <span class="glyphicon glyphicon-plus"></span> Add a new service
                </button>
                <table class="table table-striped">
                    <thead>
                    <tr>
                        <th>Name</th>
                        <th>Address</th>
                        <th>Status</th>
                        <th>Last check</th>                        
                        <th>Delete</th>
                    </tr>
                    </thead>
                    <tbody id="service-list">
                    <!-- filled using Ajax -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
  
  <script type="text/template" id="item-template">
      <td><%- name %></td><td><%- url %></td><%- url %><td><%- status %></td><td><%- lastCheck %></td><td></td>
  </script>

  <script type="text/javascript">
    var Service = Backbone.Model.extend({
        defaults: {
            id: "",
            name: "",
            url: "",
            status: "",
            lastCheck: "",
        },
        //url: "../services/",
        //idAttribute: "id"
    });

    var ServiceCollection = Backbone.Collection.extend({
      model: Service,
      url: "../services",
    });

    var AppView = Backbone.View.extend({
      el: '#serviceapp',
      initialize: function() {
        collection.on('add', this.addOne, this);
        collection.on('reset', this.addAll, this); //called on collection.fetch()
        collection.fetch();
      },
      addOne: function(service){
        var view = new ServiceView({model: service});
        $('#service-list').append(view.render().el);
      },
      addAll: function(){
        this.$('#service-list').html(''); // clean the todo list
        collection.each(this.addOne, this);
      },    
    });

    var ServiceView = Backbone.View.extend({
      tagName: 'tr',
      template: _.template($('#item-template').html()),
      render: function() {
        this.$el.html(this.template(this.model.toJSON()));
        return this;
      }
    });

    var collection = new ServiceCollection();
    var appView = new AppView();

  </script>
  
</body>
</html>